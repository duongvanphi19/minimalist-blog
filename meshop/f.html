<!doctype html>

<html lang="vi">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Invoice Generator ‚Äî Mobile First (Safe Export)</title>
        <link
            href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;600&display=swap"
            rel="stylesheet" />
        <link
            href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap"
            rel="stylesheet" />
        <link
            href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap"
            rel="stylesheet" />

        <!-- Th∆∞ vi·ªán xu·∫•t ·∫£nh v√† PDF -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
        <link rel="stylesheet" href="styles.css" />
    </head>
    <body class="theme-0">
        <div class="wrap">
            <header>
                <h1>T·∫°o h√≥a ƒë∆°n b√°n h√†ng si√™u nhanh</h1>
                <p class="subtitle">
                    Ho√†n th√†nh trong 30 gi√¢y - Mi·ªÖn ph√≠ - Ti·ªán l·ª£i - D√†nh cho
                    shop online, freelancer & doanh nghi·ªáp nh·ªè.
                </p>
                <a href="#invoiceForm" class="cta-button"
                    ><span class="cta-emoji">üìÉ</span>T·∫°o H√≥a ƒê∆°n Ngay B√¢y Gi·ªù
                    <span class="arrow bounce">‚áì</span>
                </a>
                <span style="margin-top: 8px; margin-bottom: 18px" class="small"
                    >(Nhanh - Mi·ªÖn ph√≠ - Kh√¥ng c·∫ßn ƒëƒÉng k√Ω)</span
                >
                <div class="feature-list">
                    <div class="feature-item">
                        <span class="icon">‚ú®</span>
                        <span>Ho√†n to√†n mi·ªÖn ph√≠</span>
                    </div>
                    <div class="feature-item">
                        <span class="icon">üîí</span>
                        <span>An to√†n & Ri√™ng t∆∞</span>
                    </div>
                    <div class="feature-item">
                        <span class="icon">üîë</span>
                        <span>Kh√¥ng c·∫ßn ƒëƒÉng nh·∫≠p</span>
                    </div>
                    <div class="feature-item">
                        <span class="icon">üñåÔ∏è</span>
                        <span>T√πy ch·ªânh linh ho·∫°t</span>
                    </div>
                    <div class="feature-item">
                        <span class="icon">‚ö°</span>
                        <span>Xem tr∆∞·ªõc tr·ª±c ti·∫øp</span>
                    </div>
                    <div class="feature-item">
                        <span class="icon">üì•</span>
                        <span>Xu·∫•t file ch·∫•t l∆∞·ª£ng cao</span>
                    </div>
                </div>
            </header>

            <div class="main">
                <div class="left panel">
                    <div
                        id="invoiceForm"
                        style="
                            display: flex;
                            flex-direction: column;
                            gap: 10px;
                        ">
                        <strong class="small">Nh·∫≠p th√¥ng tin h√≥a ƒë∆°n</strong>
                        <div>
                            <label class="small">T√™n shop c·ªßa b·∫°n</label>
                            <input
                                id="shopName"
                                placeholder="VD: Shop C·ªßa T√¥i" />
                            <label style="margin-top: 6px" class="small"
                                >Logo (upload ·∫£nh <1MB)</label
                            >
                            <input id="shopLogo" type="file" accept="image/*" />
                            <div
                                id="shopLogoIndicator"
                                class="upload-indicator"></div>
                        </div>

                        <div>
                            <label class="small">T√™n kh√°ch</label>
                            <input
                                id="customerName"
                                placeholder="VD: Nguy·ªÖn VƒÉn A" />
                            <div class="row" style="margin-top: 6px">
                                <div class="col">
                                    <label class="small">SƒêT</label>
                                    <input
                                        id="customerPhone"
                                        placeholder="VD: 0909xxxxxx"
                                        type="tel" />
                                </div>
                                <div class="col">
                                    <label class="small">Ng√†y ƒë·∫∑t h√†ng</label>
                                    <input id="orderDate" type="date" />
                                </div>
                            </div>
                            <label class="small" style="margin-top: 6px"
                                >ƒê·ªãa ch·ªâ nh·∫≠n</label
                            >
                            <textarea
                                id="customerAddress"
                                placeholder="VD: 123 L√™ L·ª£i, Qu·∫≠n 1, TP.HCM"></textarea>
                        </div>

                        <div>
                            <div class="row">
                                <div class="col">
                                    <label class="small">M√£ ƒë∆°n</label>
                                    <input id="orderId" placeholder="DH001" />
                                </div>
                                <div class="col">
                                    <label class="small"
                                        >Ng√†y nh·∫≠n d·ª± ki·∫øn</label
                                    >
                                    <input id="expectedDate" type="date" />
                                </div>
                            </div>

                            <div class="row" style="margin-top: 6px">
                                <div class="col">
                                    <label class="small"
                                        >Ph∆∞∆°ng th·ª©c thanh to√°n</label
                                    >
                                    <select id="paymentMethod">
                                        <option>Ti·ªÅn m·∫∑t</option>
                                        <option>Chuy·ªÉn kho·∫£n</option>
                                        <option>
                                            Thanh to√°n khi nh·∫≠n h√†ng (COD)
                                        </option>
                                    </select>
                                </div>
                                <div class="col">
                                    <label class="small">Ph√≠ ship (VNƒê)</label>
                                    <input
                                        id="shippingFee"
                                        type="number"
                                        placeholder="0" />
                                </div>
                            </div>
                            <label style="margin-top: 6px" class="small"
                                >Thanh to√°n tr∆∞·ªõc (VNƒê)</label
                            >
                            <input
                                id="paidAmount"
                                type="number"
                                placeholder="0" />
                            <label class="small" style="margin-top: 6px"
                                >Ghi ch√∫ ng·∫Øn</label
                            >
                            <input
                                id="shortNote"
                                placeholder="VD: Giao gi·ªù h√†nh ch√≠nh" />
                        </div>

                        <div>
                            <label class="small">S·∫£n ph·∫©m</label>
                            <div id="productList"></div>
                            <div class="actions">
                                <button
                                    id="addProductBtn"
                                    class="btn"
                                    type="button">
                                    + Th√™m SP
                                </button>
                                <button
                                    id="clearProducts"
                                    class="btn ghost"
                                    type="button">
                                    X√≥a h·∫øt
                                </button>
                            </div>
                            <div class="small" style="margin-top: 8px"></div>
                        </div>

                        <div style="margin-top: 8px">
                            <label class="small">Ghi ch√∫ d√†i (n·∫øu c·∫ßn)</label>
                            <textarea
                                id="note"
                                placeholder="Ghi ch√∫ cho ƒë∆°n"></textarea>
                        </div>

                        <div style="margin-top: 8px">
                            <label class="small"
                                >·∫¢nh decor g√≥c (upload ·∫£nh <1MB)</label
                            >
                            <input
                                id="flowerImage"
                                type="file"
                                accept="image/*" />
                            <div
                                id="flowerImageIndicator"
                                class="upload-indicator"></div>

                            <label class="small" style="margin-top: 6px"
                                >Ch·ªçn ·∫£nh decor g√≥c c√≥ s·∫µn</label
                            >
                            <div
                                style="
                                    display: flex;
                                    gap: 8px;
                                    margin-top: 6px;
                                    overflow-x: auto;
                                ">
                                <img
                                    class="predefined-flower-img"
                                    src="assets/uploads/transparent.png"
                                    data-image="assets/uploads/transparent.png"
                                    style="
                                        width: 50px;
                                        height: 50px;
                                        cursor: pointer;
                                        border: 2px solid transparent;
                                        border-radius: 4px;
                                        background: #fff;
                                    "
                                    alt="white" />
                                <img
                                    class="predefined-flower-img"
                                    src="assets/uploads/flower1.png"
                                    data-image="assets/uploads/flower1.png"
                                    style="
                                        width: 50px;
                                        height: 50px;
                                        cursor: pointer;
                                        border: 2px solid transparent;
                                        border-radius: 4px;
                                    "
                                    alt="Flower 1" />
                                <img
                                    class="predefined-flower-img"
                                    src="assets/uploads/flower2.png"
                                    data-image="assets/uploads/flower2.png"
                                    style="
                                        width: 50px;
                                        height: 50px;
                                        cursor: pointer;
                                        border: 2px solid transparent;
                                        border-radius: 4px;
                                    "
                                    alt="Flower 2" />
                                <img
                                    class="predefined-flower-img"
                                    src="assets/uploads/flower3.png"
                                    data-image="assets/uploads/flower3.png"
                                    style="
                                        width: 50px;
                                        height: 50px;
                                        cursor: pointer;
                                        border: 2px solid transparent;
                                        border-radius: 4px;
                                    "
                                    alt="Flower 3" />
                                <img
                                    class="predefined-flower-img"
                                    src="assets/uploads/flower4.png"
                                    data-image="assets/uploads/flower4.png"
                                    style="
                                        width: 50px;
                                        height: 50px;
                                        cursor: pointer;
                                        border: 2px solid transparent;
                                        border-radius: 4px;
                                    "
                                    alt="Flower 4" />
                                <img
                                    class="predefined-flower-img"
                                    src="assets/uploads/flower5.png"
                                    data-image="assets/uploads/flower5.png"
                                    style="
                                        width: 50px;
                                        height: 50px;
                                        cursor: pointer;
                                        border: 2px solid transparent;
                                        border-radius: 4px;
                                    "
                                    alt="Flower 5" />
                            </div>

                            <label class="small" style="margin-top: 6px"
                                >QR chuy·ªÉn kho·∫£n (upload ·∫£nh <1MB)</label
                            >
                            <input id="qrImage" type="file" accept="image/*" />
                            <div
                                id="qrImageIndicator"
                                class="upload-indicator"></div>
                            <label class="small" style="margin-top: 6px"
                                >L·ªùi c·∫£m ∆°n (footer)</label
                            >
                            <input
                                id="thankYouText"
                                placeholder="VD: C·∫£m ∆°n anh/ch·ªã ƒë√£ tin t∆∞·ªüng Shop üåø" />
                            <div style="margin-top: 8px">
                                <div class="small">Ch·ªçn b·ªô m√†u</div>
                                <div
                                    id="themeSelect"
                                    style="
                                        display: flex;
                                        gap: 8px;
                                        margin-top: 6px;
                                        overflow-x: auto;
                                    ">
                                    <div
                                        class="swatch theme-btn"
                                        data-theme="theme-0"
                                        style="
                                            width: 34px;
                                            height: 24px;
                                            background: linear-gradient(
                                                #fff,
                                                #eee
                                            );
                                            border-radius: 6px;
                                        "></div>
                                    <div
                                        class="swatch theme-btn"
                                        data-theme="theme-1"
                                        style="
                                            width: 34px;
                                            height: 24px;
                                            background: linear-gradient(
                                                #fff,
                                                #f6efe6
                                            );
                                            border-radius: 6px;
                                        "></div>
                                    <div
                                        class="swatch theme-btn"
                                        data-theme="theme-2"
                                        style="
                                            width: 34px;
                                            height: 24px;
                                            background: linear-gradient(
                                                #fffaf7,
                                                #e7f6f3
                                            );
                                            border-radius: 6px;
                                        "></div>
                                    <div
                                        class="swatch theme-btn"
                                        data-theme="theme-3"
                                        style="
                                            width: 34px;
                                            height: 24px;
                                            background: linear-gradient(
                                                #fff,
                                                #eef5ff
                                            );
                                            border-radius: 6px;
                                        "></div>
                                    <div
                                        class="swatch theme-btn"
                                        data-theme="theme-4"
                                        style="
                                            width: 34px;
                                            height: 24px;
                                            background: linear-gradient(
                                                #fff,
                                                #fff1f4
                                            );
                                            border-radius: 6px;
                                        "></div>

                                    <div
                                        class="swatch theme-btn"
                                        data-theme="theme-5"
                                        style="
                                            width: 34px;
                                            height: 24px;
                                            background: linear-gradient(
                                                #fff,
                                                #ffc107
                                            );
                                            border-radius: 6px;
                                        "></div>
                                    <div
                                        class="swatch theme-btn"
                                        data-theme="theme-6"
                                        style="
                                            width: 34px;
                                            height: 24px;
                                            background: linear-gradient(
                                                #fff,
                                                #7eb8f3
                                            );
                                            border-radius: 6px;
                                        "></div>
                                    <div
                                        class="swatch theme-btn"
                                        data-theme="theme-7"
                                        style="
                                            width: 34px;
                                            height: 24px;
                                            background: linear-gradient(
                                                #fff,
                                                #ba68c8
                                            );
                                            border-radius: 6px;
                                        "></div>
                                    <div
                                        class="swatch theme-btn"
                                        data-theme="theme-8"
                                        style="
                                            width: 34px;
                                            height: 24px;
                                            background: linear-gradient(
                                                #fff,
                                                #da6d51
                                            );
                                            border-radius: 6px;
                                        "></div>
                                </div>
                            </div>
                        </div>

                        <div style="display: flex; gap: 8px; margin-top: 36px">
                            <button id="saveBtn" class="btn" type="button">
                                L∆∞u t√πy ch·ªçn
                            </button>
                            <button
                                id="resetBtn"
                                class="btn ghost"
                                type="button">
                                Reset ‚Ü∫
                            </button>
                        </div>
                    </div>
                </div>

                <div class="right panel">
                    <div>
                        <div>
                            <strong class="small">Xem tr∆∞·ªõc h√≥a ƒë∆°n</strong>
                        </div>
                    </div>

                    <div class="preview-wrap">
                        <div
                            id="card"
                            class="card"
                            role="img"
                            aria-label="Invoice preview">
                            <img
                                id="flowerTL"
                                class="corner tl"
                                src=""
                                alt=""
                                style="display: none" />
                            <img
                                id="flowerBR"
                                class="corner br"
                                src=""
                                alt=""
                                style="display: none" />
                            <img
                                id="outLogo"
                                class="logo"
                                src=""
                                alt=""
                                style="display: none" />
                            <div class="shop-name" id="outShopName">
                                Shop C·ªßa T√¥i
                            </div>
                            <div class="title">X√ÅC NH·∫¨N ƒê∆†N H√ÄNG</div>

                            <div class="meta">
                                <div class="row">
                                    <div>
                                        <strong>Kh√°ch:</strong>
                                        <span id="outCustomerName"
                                            >Nguy·ªÖn VƒÉn A</span
                                        >
                                    </div>
                                    <div>
                                        <strong>SƒêT:</strong>
                                        <span id="outCustomerPhone"
                                            >0909xxxxxx</span
                                        >
                                    </div>
                                </div>
                                <div style="margin-top: 6px">
                                    <strong>ƒê·ªãa ch·ªâ:</strong>
                                    <span id="outCustomerAddress"
                                        >123 L√™ L·ª£i, Q1</span
                                    >
                                </div>
                                <div style="margin-top: 6px" class="row">
                                    <div>
                                        <strong>Ng√†y ƒë·∫∑t h√†ng:</strong>
                                        <span id="outOrderDate"
                                            >__/__/____</span
                                        >
                                    </div>
                                    <div>
                                        <strong>Nh·∫≠n d·ª± ki·∫øn:</strong>
                                        <span id="outExpectedDate"
                                            >__/__/____</span
                                        >
                                    </div>
                                </div>
                                <div style="margin-top: 6px" class="row">
                                    <div>
                                        <strong>M√£:</strong>
                                        <span id="outOrderId">DH001</span>
                                    </div>
                                    <div>
                                        <strong>Thanh to√°n:</strong>
                                        <span id="outPaymentMethod"
                                            >Ti·ªÅn m·∫∑t</span
                                        >
                                    </div>
                                </div>
                            </div>

                            <div class="products" id="outProducts"></div>

                            <div class="total">
                                <div>T·ªïng</div>
                                <div id="outTotal">0 ‚Ç´</div>
                            </div>
                            <div class="total">
                                <div>ƒê√£ thanh to√°n</div>
                                <div id="outPaidAmount">0 ‚Ç´</div>
                            </div>

                            <div class="note" id="outShortNote"></div>
                            <img
                                id="outQr"
                                class="qr"
                                src=""
                                alt=""
                                style="display: none" />
                            <div class="footer" id="outThank">
                                C·∫£m ∆°n anh/ch·ªã ƒë√£ tin t∆∞·ªüng Shop!
                            </div>
                        </div>
                    </div>
                    <p style="font-style: italic" class="small">
                        Ki·ªÉm tra k·ªπ th√¥ng tin tr∆∞·ªõc khi in ho·∫∑c g·ª≠i cho kh√°ch
                    </p>

                    <div
                        style="
                            display: flex;
                            gap: 8px;
                            margin-top: 10px;
                            justify-content: center;
                            flex-direction: column;
                        ">
                        <button id="downloadBtn" class="btn">üì• T·∫£i PNG</button>
                        <button id="downloadPdf" class="btn">üì• T·∫£i PDF</button>
                        <button id="saveToHistoryBtn" class="btn">
                            üíæ L∆∞u v√†o L·ªãch s·ª≠
                        </button>
                    </div>
                </div>
            </div>

            <div
                class="panel"
                id="history-container"
                style="max-width: 600px; margin: 24px auto">
                <div
                    style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 12px;
                    ">
                    <div>
                        <strong class="small">L·ªãch s·ª≠ c√°c ƒë∆°n g·∫ßn ƒë√¢y</strong>
                    </div>
                    <button
                        id="clearHistoryBtn"
                        class="btn warn"
                        type="button"
                        style="padding: 5px 10px">
                        X√≥a L·ªãch s·ª≠
                    </button>
                </div>
                <ul id="history-list"></ul>
            </div>

            <footer
                style="
                    text-align: center;
                    font-size: 12px;
                    color: var(--muted);
                    margin-top: 6px;
                ">
                <div style="margin-top: 4px; margin-bottom: 24px">
                    <span style="font-style: italic"
                        >D·ªØ li·ªáu ƒë∆∞·ª£c l∆∞u c·ª•c b·ªô tr√™n tr√¨nh duy·ªát c·ªßa b·∫°n ‚Äì Ho√†n
                        to√†n ri√™ng t∆∞</span
                    >
                </div>
                <div>ƒê∆∞·ª£c t·∫°o b·ªüi duongvanphi19</div>
                <div style="margin: 0 4px">
                    <p>
                        B·∫°n th√≠ch c√¥ng c·ª• n√†y? ·ª¶ng h·ªô m√¨nh ƒë·ªÉ duy tr√¨ v√† ph√°t
                        tri·ªÉn th√™m t√≠nh nƒÉng nh√©!
                    </p>
                    <a
                        href="https://www.buymeacoffee.com/phi19"
                        target="_blank"
                        style="
                            text-decoration: none;
                            display: inline-block;
                            margin-left: 8px;
                        ">
                        <img
                            src="https://img.buymeacoffee.com/button-api/?text=Buy me a coffee&slug=phi19&button_colour=FFDD00&font_colour=000000&font_family=Poppins&outline_colour=000000&coffee_colour=ffffff"
                            alt="Buy Me A Coffee" />
                    </a>
                </div>
            </footer>
        </div>

        <script>
            /* ======== Helpers & Constants ======== */
            const $ = (id) => document.getElementById(id);
            const LS_FORM = "invoice_v3_form";
            const LS_PRODUCTS = "invoice_v3_products";
            const LS_IMAGES = "invoice_v3_images";
            const LS_THEME = "invoice_v3_theme";
            const LS_HISTORY = "invoice_v3_history";
            const MAX_FILE_SIZE = 1024 * 1024;

            // IndexedDB constants (safely declared)
            

            // Hidden decor codes (keys are normalized WITHOUT leading '#')
            const HIDDEN_DECOR_MAP = {
                vietnam: "assets/uploads/vietnam-national-day.png",
                midautumn: "assets/uploads/mid-autumn-festival.png",
                neko: "assets/uploads/maneki-neko.png",
                valentine: "assets/uploads/valentine.png",
                vulan: "assets/uploads/vulan.png",
                halloween: "assets/uploads/halloween.png",
                xmas: "assets/uploads/xmas.png"
            };

            let originalFlowerImageSrc = null;

            // Map month -> decor (keys are month numbers)
            const MONTHLY_DECOR_MAP = {
                2: "assets/uploads/valentine.png", // Feb - Valentine
                8: "assets/uploads/vulan.png", // Aug - Mid-Autumn
                9: "assets/uploads/vietnam-national-day.png", // Sep - VN National Day
                12: "assets/uploads/xmas.png" // Dec - Christmas
            };

            function setMonthlyDecor() {
                try {
                    const currentMonth = new Date().getMonth() + 1; // 1..12
                    const monthlyImagePath = MONTHLY_DECOR_MAP[currentMonth];
                    // only set when we have a valid path to avoid url(undefined)
                    if (monthlyImagePath) {
                        document.documentElement.style.setProperty(
                            "--flower-image",
                            `url(${monthlyImagePath})`
                        );
                    } else {
                        document.documentElement.style.setProperty(
                            "--flower-image",
                            "none"
                        );
                    }
                } catch (e) {
                    console.warn("setMonthlyDecor failed", e);
                }
            }

            /* ======== Decor code input (orderId) ======== */
            // Listen for special codes (e.g. 'xmas' or '#xmas') in the orderId field
            if (document && document.addEventListener) {
                document.addEventListener("DOMContentLoaded", () => {
                    const orderEl = $("orderId");
                    if (orderEl) {
                        orderEl.addEventListener("input", (e) => {
                            const raw = e.target.value.trim().toLowerCase();
                            const key = raw.replace(/^#/, ""); // normalize

                            if (!key) return;

                            if (key === "reset") {
                                setDecorImageFromPath(
                                    originalFlowerImageSrc || ""
                                );
                                return;
                            }

                            const hiddenImagePath = HIDDEN_DECOR_MAP[key];
                            if (hiddenImagePath) {
                                setDecorImageFromPath(hiddenImagePath);
                                return;
                            }

                            // if no special code, and current stored image equals one of hidden ones, restore original
                            const imgs = JSON.parse(
                                localStorage.getItem(LS_IMAGES) || "{}"
                            );
                            if (
                                Object.values(HIDDEN_DECOR_MAP).includes(
                                    imgs.flowerImg
                                )
                            ) {
                                setDecorImageFromPath(
                                    originalFlowerImageSrc || ""
                                );
                            }
                        });
                    }
                });
            }

            function setDecorImageFromPath(path) {
                const imgs = JSON.parse(
                    localStorage.getItem(LS_IMAGES) || "{}"
                );
                imgs.flowerImg = path;
                localStorage.setItem(LS_IMAGES, JSON.stringify(imgs));
                if ($("flowerTL")) {
                    $("flowerTL").src = path;
                    $("flowerTL").style.display = path ? "block" : "none";
                }
                if ($("flowerBR")) {
                    $("flowerBR").src = path;
                    $("flowerBR").style.display = path ? "block" : "none";
                }
                document
                    .querySelectorAll(".predefined-flower-img")
                    .forEach((img) => {
                        if (img.getAttribute("data-image") === path) {
                            img.style.border = "2px solid var(--accent)";
                        } else {
                            img.style.border = "2px solid transparent";
                        }
                    });
            }



            /* ======== Utilities ======== */
            function toCurrency(n) {
                return (Number(n) || 0).toLocaleString("vi-VN");
            }
            function dataURLFromFile(file) {
                return new Promise((res, rej) => {
                    const r = new FileReader();
                    r.onload = (e) => res(e.target.result);
                    r.onerror = rej;
                    r.readAsDataURL(file);
                });
            }
            function escapeHtml(s) {
                return String(s || "").replace(
                    /[&<>\"']/g,
                    (m) =>
                        ({
                            "&": "&amp;",
                            "<": "&lt;",
                            ">": "&gt;",
                            '"': "&quot;",
                            "'": "&#39;"
                        })[m]
                );
            }

            /* ======== History Functions ======== */
            function getFormData() {
                const formState = {};
                const ids = [
                    "shopName",
                    "customerName",
                    "customerPhone",
                    "customerAddress",
                    "orderDate",
                    "expectedDate",
                    "orderId",
                    "paidAmount",
                    "paymentMethod",
                    "shippingFee",
                    "shortNote",
                    "note",
                    "thankYouText"
                ];
                ids.forEach((id) => {
                    const el = $(id);
                    if (el) formState[id] = el.value;
                });
                formState.products = getProducts();
                formState.images = JSON.parse(
                    localStorage.getItem(LS_IMAGES) || "{}"
                );
                formState.theme = localStorage.getItem(LS_THEME) || "theme-0";
                return formState;
            }

            function loadFormData(data) {
                if (!data) return;
                const ids = [
                    "shopName",
                    "customerName",
                    "customerPhone",
                    "customerAddress",
                    "orderDate",
                    "expectedDate",
                    "orderId",
                    "paidAmount",
                    "paymentMethod",
                    "shippingFee",
                    "shortNote",
                    "note",
                    "thankYouText"
                ];
                ids.forEach((id) => {
                    if ($(id) && data[id] !== undefined) $(id).value = data[id];
                });

                if (data.products) {
                    $("productList").innerHTML = "";
                    data.products.forEach((p) => addProduct(p));
                }

                // safe: data.images might be undefined in older items
                localStorage.setItem(
                    LS_IMAGES,
                    JSON.stringify(data.images || {})
                );
                loadImages();

                if (data.theme) {
                    setTheme(data.theme);
                    document.querySelectorAll(".theme-btn").forEach((b) => {
                        if (b.dataset.theme === data.theme)
                            b.classList.add("selected");
                        else b.classList.remove("selected");
                    });
                }
                updateInvoice();
            }

            function saveInvoiceToHistory() {
                const invoiceData = getFormData();
                invoiceData.timestamp = Date.now();

                let history = JSON.parse(
                    localStorage.getItem(LS_HISTORY) || "[]"
                );
                history.unshift(invoiceData);
                localStorage.setItem(LS_HISTORY, JSON.stringify(history));

                renderHistory();
                alert("ƒê√£ l∆∞u h√≥a ƒë∆°n v√†o l·ªãch s·ª≠.");
            }

            function renderHistory() {
                const history = JSON.parse(
                    localStorage.getItem(LS_HISTORY) || "[]"
                );
                const historyList = $("history-list");
                historyList.innerHTML = "";

                if (!history || history.length === 0) {
                    historyList.innerHTML = `<li class="">Ch∆∞a c√≥ h√≥a ƒë∆°n n√†o ƒë∆∞·ª£c l∆∞u.</li>`;
                    return;
                }

                history.forEach((inv) => {
                    const li = document.createElement("li");
                    li.classList.add(inv.theme || "theme-0");

                    const thumbSrc = escapeHtml(
                        (inv.images && inv.images.flowerImg) || ""
                    );
                    const thumbDisplay = thumbSrc ? "block" : "none";

                    li.innerHTML = `
        <img class="flower-thumbnail" src="${thumbSrc}" alt="Decor" style="display: ${thumbDisplay};">
        
        <div class="invoice-details">
            <span class="history-shop-name">${escapeHtml(
                inv.customerName || "ƒê∆°n h√†ng"
            )} - ${escapeHtml(inv.customerPhone || "Kh√¥ng c√≥ SƒêT")}</span>
            <span class="history-date">${new Date(inv.timestamp).toLocaleString(
                "vi-VN"
            )}</span>
        </div>
        <div class="invoice-actions">
            <button class="load-btn" data-id="${
                inv.timestamp
            }">T·∫£i l·∫°i ‚Ü∂ </button>
            <button class="delete-btn" data-id="${inv.timestamp}">X√≥a √ó</button>
        </div>
    `;
                    historyList.appendChild(li);
                });
            }

            function loadInvoiceFromHistory(id) {
                const history = JSON.parse(
                    localStorage.getItem(LS_HISTORY) || "[]"
                );
                const invoiceToLoad = history.find(
                    (inv) => inv.timestamp == id
                );
                if (invoiceToLoad) {
                    loadFormData(invoiceToLoad);
                    alert(
                        `ƒê√£ t·∫£i l·∫°i h√≥a ƒë∆°n "${
                            invoiceToLoad.shopName || "ƒê∆°n h√†ng"
                        }".`
                    );
                }
            }

            function deleteInvoiceFromHistory(id) {
                let history = JSON.parse(
                    localStorage.getItem(LS_HISTORY) || "[]"
                );
                history = history.filter((inv) => inv.timestamp != id);
                localStorage.setItem(LS_HISTORY, JSON.stringify(history));
                renderHistory();
                alert("ƒê√£ x√≥a h√≥a ƒë∆°n kh·ªèi l·ªãch s·ª≠.");
            }

            function clearHistory() {
                if (
                    confirm(
                        "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a to√†n b·ªô l·ªãch s·ª≠ h√≥a ƒë∆°n?"
                    )
                ) {
                    localStorage.removeItem(LS_HISTORY);
                    renderHistory();
                    alert("ƒê√£ x√≥a to√†n b·ªô l·ªãch s·ª≠.");
                }
            }

            /* ======== Products ======== */
            function createProductElement(p = {}) {
                const el = document.createElement("div");
                el.className = "product-item";
                el.innerHTML = `
                <input class="productName" placeholder="T√™n s·∫£n ph·∫©m" value="${escapeHtml(
                    p.name || ""
                )}">
                <input class="productQty" placeholder="SL" type="number" min="0" value="${
                    p.qty || ""
                }">
                <input class="productPrice" placeholder="Gi√° (VNƒê)" type="number" min="0" value="${
                    p.price || ""
                }">
                <button class="remove-btn" title="X√≥a">√ó</button>
            `;
                el.querySelector(".remove-btn").addEventListener(
                    "click",
                    () => {
                        el.remove();
                        debouncedUpdateInvoice();
                    }
                );
                el.querySelectorAll("input").forEach((i) =>
                    i.addEventListener("input", debouncedUpdateInvoice)
                );
                return el;
            }
            function addProduct(p) {
                $("productList").appendChild(createProductElement(p || {}));
                debouncedUpdateInvoice();
            }
            function clearProducts() {
                $("productList").innerHTML = "";
                debouncedUpdateInvoice();
            }

            function getProducts() {
                const nodes = document.querySelectorAll(
                    "#productList .product-item"
                );
                const arr = [];
                nodes.forEach((n) => {
                    const name = n.querySelector(".productName").value.trim();
                    const qty =
                        Number(n.querySelector(".productQty").value) || 0;
                    const price =
                        Number(n.querySelector(".productPrice").value) || 0;
                    if (name) arr.push({ name, qty, price });
                });
                return arr;
            }
            function saveProducts() {
                localStorage.setItem(
                    LS_PRODUCTS,
                    JSON.stringify(getProducts())
                );
            }

            /* ======== Form save/load (localStorage) ======== */
            function saveForm() {
                const ids = [
                    "shopName",
                    "customerName",
                    "customerPhone",
                    "customerAddress",
                    "orderDate",
                    "expectedDate",
                    "orderId",
                    "paidAmount",
                    "paymentMethod",
                    "shippingFee",
                    "shortNote",
                    "note",
                    "thankYouText"
                ];
                const data = {};
                ids.forEach((id) => {
                    const el = $(id);
                    if (el) data[id] = el.value;
                });
                localStorage.setItem(LS_FORM, JSON.stringify(data));
            }
            function loadForm() {
                const data = JSON.parse(localStorage.getItem(LS_FORM) || "{}");
                if (!data) return;
                Object.keys(data).forEach((k) => {
                    if ($(k)) $(k).value = data[k];
                });
            }

            /* ======== Images save/load (base64) ======== */
            async function handleImageUpload(inputId, outIds, storageKey) {
                const input = $(inputId);
                if (!input) return;

                const indicator = $(`${inputId}Indicator`);

                input.addEventListener("change", async (e) => {
                    indicator.textContent = "";
                    indicator.className = "upload-indicator";

                    const f = e.target.files[0];
                    if (!f) {
                        indicator.style.display = "none";
                        return;
                    }
                    indicator.textContent = "ƒêang t·∫£i...";
                    indicator.className = "upload-indicator loading";
                    indicator.style.display = "block";

                    if (f.size > MAX_FILE_SIZE) {
                        indicator.textContent = `L·ªói: File qu√° l·ªõn (> 1MB). Vui l√≤ng ch·ªçn file kh√°c.`;
                        indicator.className = "upload-indicator error";
                        input.value = "";
                        return;
                    }
                    try {
                        const data = await dataURLFromFile(f);
                        const imgs = JSON.parse(
                            localStorage.getItem(LS_IMAGES) || "{}"
                        );
                        imgs[storageKey] = data;
                        localStorage.setItem(LS_IMAGES, JSON.stringify(imgs));
                        outIds.forEach((id) => {
                            if ($(id)) {
                                $(id).src = data;
                                $(id).style.display = "block";
                            }
                        });

                        indicator.textContent = "T·∫£i l√™n th√†nh c√¥ng!";
                        indicator.className = "upload-indicator success";
                        setTimeout(() => {
                            indicator.style.display = "none";
                        }, 3000);
                        // B·ªè ch·ªçn ·∫£nh c√≥ s·∫µn khi ng∆∞·ªùi d√πng upload ·∫£nh m·ªõi
                        if (storageKey === "flowerImg") {
                            originalFlowerImageSrc = data;
                            document
                                .querySelectorAll(".predefined-flower-img")
                                .forEach((img) => {
                                    img.style.border = "2px solid transparent";
                                });
                        }
                    } catch (error) {
                        console.error("L·ªói khi t·∫£i file:", error);
                        indicator.textContent =
                            "L·ªói khi t·∫£i file. Vui l√≤ng th·ª≠ l·∫°i.";
                        indicator.className = "upload-indicator error";
                        input.value = "";
                    }
                });
            }

            function loadImages() {
                const imgs = JSON.parse(
                    localStorage.getItem(LS_IMAGES) || "{}"
                );

                // C·∫≠p nh·∫≠t logo
                const outLogo = $("outLogo");
                if (outLogo) {
                    if (imgs.shopLogo) {
                        outLogo.src = imgs.shopLogo;
                        outLogo.style.display = "block";
                    } else {
                        outLogo.src = "";
                        outLogo.style.display = "none";
                    }
                }

                // X·ª≠ l√Ω ·∫£nh decor g√≥c
                if (imgs.flowerImg) {
                    originalFlowerImageSrc = imgs.flowerImg;
                    if ($("flowerTL")) {
                        $("flowerTL").src = imgs.flowerImg;
                        $("flowerTL").style.display = "block";
                    }
                    if ($("flowerBR")) {
                        $("flowerBR").src = imgs.flowerImg;
                        $("flowerBR").style.display = "block";
                    }
                    document
                        .querySelectorAll(".predefined-flower-img")
                        .forEach((img) => {
                            if (
                                img.getAttribute("data-image") ===
                                imgs.flowerImg
                            ) {
                                img.style.border = "2px solid var(--accent)";
                            } else {
                                img.style.border = "2px solid transparent";
                            }
                        });
                } else {
                    if ($("flowerTL")) $("flowerTL").style.display = "none";
                    if ($("flowerBR")) $("flowerBR").style.display = "none";
                    document
                        .querySelectorAll(".predefined-flower-img")
                        .forEach((img) => {
                            img.style.border = "2px solid transparent";
                        });
                }

                // C·∫≠p nh·∫≠t QR Code
                const outQr = $("outQr");
                if (outQr) {
                    if (imgs.qrImg) {
                        outQr.src = imgs.qrImg;
                        outQr.style.display = "block";
                    } else {
                        outQr.src = "";
                        outQr.style.display = "none";
                    }
                }
            }

            /* ======== Theme ======== */
            function setTheme(cls) {
                document.body.classList.remove(
                    "theme-0",
                    "theme-1",
                    "theme-2",
                    "theme-3",
                    "theme-4",
                    "theme-5",
                    "theme-6",
                    "theme-7",
                    "theme-8"
                );
                document.body.classList.add(cls);
                localStorage.setItem(LS_THEME, cls);
            }

            function loadTheme() {
                const t = localStorage.getItem(LS_THEME) || "theme-1";
                setTheme(t);
                document.querySelectorAll(".theme-btn").forEach((b) => {
                    if (b.dataset.theme === t) b.classList.add("selected");
                    else b.classList.remove("selected");
                });
            }

            /* ======== Debounced Update ======== */
            let updateTimeout = null;
            function debouncedUpdateInvoice() {
                clearTimeout(updateTimeout);
                updateTimeout = setTimeout(() => {
                    updateInvoice();
                    saveForm();
                    saveProducts();
                }, 300);
            }
            // H√†m ƒë·ªãnh d·∫°ng ng√†y
            function formatDate(date) {
                if (!date) return "";
                const [year, month, day] = date.split("-");
                return `${day}/${month}/${year}`;
            }

            /* ======== Update preview ======== */
            function updateInvoice() {
                $("outShopName").innerText =
                    $("shopName").value.trim() || "Shop C·ªßa T√¥i";
                $("outCustomerName").innerText =
                    $("customerName").value.trim() || "T√™n kh√°ch h√†ng";
                $("outCustomerPhone").innerText =
                    $("customerPhone").value.trim() || "SƒêT";
                $("outCustomerAddress").innerText =
                    $("customerAddress").value.trim() || "ƒê·ªãa ch·ªâ nh·∫≠n";
                $("outOrderDate").innerText =
                    formatDate($("orderDate").value) || "__/__/____";
                $("outExpectedDate").innerText =
                    formatDate($("expectedDate").value) || "__/__/____";
                $("outOrderId").innerText = $("orderId").value.trim() || "";
                $("outPaymentMethod").innerText =
                    $("paymentMethod").value || "Ti·ªÅn m·∫∑t";
                $("outShortNote").innerText = $("shortNote").value.trim() || "";
                $("outThank").innerText =
                    $("thankYouText").value.trim() ||
                    "C·∫£m ∆°n anh/ch·ªã ƒë√£ tin t∆∞·ªüng ·ªßng h·ªô Shop!";

                const prods = getProducts();
                const out = $("outProducts");
                out.innerHTML = "";
                let total = 0;
                if (prods.length === 0) {
                    out.innerHTML =
                        '<div style="text-align:center;color:var(--muted);padding:8px">Kh√¥ng c√≥ s·∫£n ph·∫©m</div>';
                } else {
                    const frag = document.createDocumentFragment();
                    const headerRow = document.createElement("div");
                    headerRow.className = "callout prod-row";
                    headerRow.style = "color: var(--accent)";
                    headerRow.innerHTML = `<div style="flex:1">S·∫£n ph·∫©m</div><div style="width:24px;text-align:right">SL</div><div style="width:90px;text-align:right">ƒê∆°n gi√°</div><div style="width:90px;text-align:right">Th√†nh ti·ªÅn</div>`;
                    frag.appendChild(headerRow);
                    prods.forEach((p) => {
                        const subtotal = p.qty * p.price;
                        total += subtotal;
                        const row = document.createElement("div");
                        row.className = "prod-row";
                        row.innerHTML = `<div style="flex:1">${escapeHtml(
                            p.name
                        )}</div><div style="width:24px;text-align:right">${
                            p.qty
                        }</div><div style="width:90px;text-align:right">${toCurrency(
                            p.price
                        )} ‚Ç´</div><div style="width:90px;text-align:right">${toCurrency(
                            subtotal
                        )} ‚Ç´</div>`;
                        frag.appendChild(row);
                    });
                    out.appendChild(frag);
                }
                const shipping = Number($("shippingFee").value) || 0;
                if (shipping > 0) {
                    const r = document.createElement("div");
                    r.className = "prod-row";
                    r.innerHTML = `<div style="flex:1">Ph√≠ ship</div><div style="width:36px"></div><div style="width:90px;text-align:right"></div><div style="width:110px;text-align:right">${toCurrency(
                        shipping
                    )} ‚Ç´</div>`;
                    out.appendChild(r);
                    total += shipping;
                }
                $("outTotal").innerText = toCurrency(total) + " ‚Ç´";
                $("outPaidAmount").innerText =
                    toCurrency($("paidAmount").value) + " ‚Ç´";
            }

            /* ======== Save/load products & form on start ======== */
            function loadProducts() {
                const arr = JSON.parse(
                    localStorage.getItem(LS_PRODUCTS) || "[]"
                );
                $("productList").innerHTML = "";
                if (!arr || arr.length === 0) {
                    addProduct({
                        name: "B.Begin Non-Alcohol Perfume",
                        qty: 1,
                        price: 1200000
                    });
                } else arr.forEach((p) => addProduct(p));
            }

            /* ======== Init Events ======== */
            document.addEventListener("DOMContentLoaded", async () => {


                // Ensure default flower image exists in localStorage
                let imgs = JSON.parse(localStorage.getItem(LS_IMAGES) || "{}");
                if (!imgs.flowerImg) {
                    imgs.flowerImg = "assets/uploads/transparent.png";
                    localStorage.setItem(LS_IMAGES, JSON.stringify(imgs));
                }

                // load saved
                loadForm();
                loadProducts();
                loadImages();
                setMonthlyDecor();
                loadTheme();
                renderHistory();
                updateInvoice();

                // input live update
                document
                    .querySelectorAll(
                        '#invoiceForm input:not([type="file"]), #invoiceForm textarea, #invoiceForm select'
                    )
                    .forEach((inp) =>
                        inp.addEventListener("input", debouncedUpdateInvoice)
                    );

                // file uploads (store base64)
                handleImageUpload("shopLogo", ["outLogo"], "shopLogo");
                handleImageUpload(
                    "flowerImage",
                    ["flowerTL", "flowerBR"],
                    "flowerImg"
                );
                handleImageUpload("qrImage", ["outQr"], "qrImg");

                // add/clear product
                $("addProductBtn").addEventListener("click", () =>
                    addProduct({})
                );
                $("clearProducts").addEventListener("click", () => {
                    if (confirm("X√≥a h·∫øt s·∫£n ph·∫©m?")) clearProducts();
                });

                // save/reset
                $("saveBtn").addEventListener("click", () => {
                    saveForm();
                    saveProducts();
                    alert("ƒê√£ l∆∞u v√†o tr√¨nh duy·ªát.");
                });
                $("resetBtn").addEventListener("click", () => {
                    if (confirm("Reset to√†n b·ªô d·ªØ li·ªáu?")) {
                        // Ch·ªâ x√≥a c√°c kh√≥a li√™n quan ƒë·∫øn form, kh√¥ng x√≥a l·ªãch s·ª≠
                        localStorage.removeItem(LS_FORM);
                        localStorage.removeItem(LS_PRODUCTS);
                        localStorage.removeItem(LS_IMAGES);
                        localStorage.removeItem(LS_THEME);
                        
                        location.reload();
                    }
                });

                // L·ªãch s·ª≠ ƒë∆°n h√†ng
                $("saveToHistoryBtn").addEventListener(
                    "click",
                    saveInvoiceToHistory
                );
                $("clearHistoryBtn").addEventListener("click", clearHistory);
                $("history-list").addEventListener("click", (event) => {
                    const target = event.target;
                    const id = target.getAttribute("data-id");
                    if (target.classList.contains("load-btn")) {
                        loadInvoiceFromHistory(id);
                    } else if (target.classList.contains("delete-btn")) {
                        if (confirm("B·∫°n c√≥ mu·ªën x√≥a h√≥a ƒë∆°n n√†y kh√¥ng?")) {
                            deleteInvoiceFromHistory(id);
                        }
                    }
                });

                // theme buttons
                document.querySelectorAll(".theme-btn").forEach((btn) =>
                    btn.addEventListener("click", () => {
                        setTheme(btn.dataset.theme);
                        btn.classList.add("selected");
                        document.querySelectorAll(".theme-btn").forEach((b) => {
                            if (b !== btn) b.classList.remove("selected");
                        });
                    })
                );

                // Predefined flower images
                document
                    .querySelectorAll(".predefined-flower-img")
                    .forEach((btn) => {
                        btn.addEventListener("click", () => {
                            const imagePath = btn.getAttribute("data-image");
                            const imgs = JSON.parse(
                                localStorage.getItem(LS_IMAGES) || "{}"
                            );
                            imgs.flowerImg = imagePath;
                            originalFlowerImageSrc = imagePath;
                            setDecorImageFromPath(imagePath);
                            localStorage.setItem(
                                LS_IMAGES,
                                JSON.stringify(imgs)
                            );
                            // G·ªçi l·∫°i loadImages ƒë·ªÉ c·∫≠p nh·∫≠t c·∫£ hero section v√† invoice
                            loadImages();
                        });
                    });

                document
                    .getElementById("downloadPdf")
                    .addEventListener("click", () => {
                        const capture = document.getElementById("card"); // ƒë·ªïi ID th√†nh ph·∫ßn t·ª≠ h√≥a ƒë∆°n
                        html2canvas(capture, { scale: 2 }).then((canvas) => {
                            const { jsPDF } = window.jspdf;
                            const imgData = canvas.toDataURL("image/png");

                            // L·∫•y k√≠ch th∆∞·ªõc ·∫£nh (px ‚Üí mm) theo 96dpi
                            const pxToMm = (px) => px * 0.264583;
                            const pdfWidth = pxToMm(canvas.width);
                            const pdfHeight = pxToMm(canvas.height);

                            // T·∫°o PDF v·ªõi k√≠ch th∆∞·ªõc b·∫±ng ch√≠nh ·∫£nh
                            const pdf = new jsPDF("p", "mm", [
                                pdfWidth,
                                pdfHeight
                            ]);
                            pdf.addImage(
                                imgData,
                                "PNG",
                                0,
                                0,
                                pdfWidth,
                                pdfHeight
                            );
                            pdf.save(
                                `invoice_${$("orderId").value || "order"}.pdf`
                            );
                        });
                    });
                // download (safe)
                $("downloadBtn").addEventListener("click", async () => {
                    const btn = $("downloadBtn");

                    btn.disabled = true;
                    btn.textContent = "ƒêang t·∫°o ·∫£nh...";
                    try {
                        // wait images inside card to load (logo/flower/qr)
                        const imgs = Array.from(
                            document.querySelectorAll("#card img")
                        );
                        await Promise.all(
                            imgs.map(
                                (img) =>
                                    new Promise((resolve) => {
                                        if (!img.src) return resolve();
                                        if (img.complete) return resolve();
                                        img.onload = () => resolve();
                                        img.onerror = () => resolve();
                                    })
                            )
                        );

                        // compute safe scale: don't exceed 3 to avoid memory spikes
                        const card = $("card");
                        const origWidth = card.clientWidth || 360;
                        const targetWidth = 1080;
                        let scale = Math.min(
                            3,
                            Math.max(1.5, targetWidth / origWidth)
                        );
                        // render with html2canvas
                        const canvas = await html2canvas(card, {
                            useCORS: true,
                            scale: scale,
                            backgroundColor: null
                        });
                        // export via blob to avoid huge dataURL memory peak
                        canvas.toBlob(
                            (blob) => {
                                const url = URL.createObjectURL(blob);
                                const a = document.createElement("a");
                                a.href = url;
                                a.download = `invoice_${
                                    $("orderId").value || "order"
                                }.png`;
                                document.body.appendChild(a);
                                a.click();
                                a.remove();
                                setTimeout(
                                    () => URL.revokeObjectURL(url),
                                    10000
                                );
                            },
                            "image/png",
                            0.95
                        );

                        // NOTE: do not auto-save to history on download to avoid surprises for users
                        // saveInvoiceToHistory(); // <-- intentionally disabled
                    } catch (err) {
                        console.error(err);
                        alert("C√≥ l·ªói khi t·∫°o ·∫£nh. Th·ª≠ l·∫°i nh√©.");
                    } finally {
                        btn.disabled = false;
                        btn.textContent = "üì• T·∫£i PNG";
                    }
                });
            }); // end DOMContentLoaded
        </script>

<!-- Firebase SDK v8 (Compat mode) -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
  // Thay th√¥ng tin n√†y b·∫±ng c·∫•u h√¨nh Firebase c·ªßa b·∫°n
  var firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  firebase.initializeApp(firebaseConfig);
  var db = firebase.database();

  document.addEventListener("DOMContentLoaded", function() {
    var saveBtn = document.getElementById('saveHistory');
    if (saveBtn) {
      saveBtn.addEventListener('click', function() {
        var data = {
          name: document.getElementById('customerName')?.value || "",
          contact: document.getElementById('customerContact')?.value || "",
          invoiceNumber: document.getElementById('invoiceNumber')?.value || "",
          total: document.getElementById('totalAmount')?.innerText || "",
          device: navigator.userAgent,
          time: new Date().toLocaleString()
        };
        db.ref("invoices").push(data)
          .then(() => console.log("‚úÖ ƒê√£ l∆∞u h√≥a ƒë∆°n v√†o Firebase!"))
          .catch(err => console.error("‚ùå L·ªói l∆∞u Firebase:", err));
      });
    }
  });
</script>

</body>
</html>
