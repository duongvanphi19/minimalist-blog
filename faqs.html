<!doctype html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
        <link rel="icon" href="favicon.ico" type="image/x-icon" />
        <title>FAQs t·ª´ Google Sheets</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Inter", "Segoe UI", sans-serif;
                background-color: #fff;
                color: #111;
                padding: 40px 20px;
                line-height: 1.7;
            }

            .container {
                max-width: 900px;
                margin: 0 auto;
            }

            h1 {
                font-size: 3rem;
                font-weight: 800;
                text-align: center;
                margin-bottom: 40px;
                color: #000;
            }

            .search-bar input {
                width: 100%;
                padding: 18px;
                font-size: 1.1rem;
                border: 2px solid #000;
                border-radius: 0;
                outline: none;
                background-color: #fff;
                margin-bottom: 40px;
                font-weight: 600;
            }

            .chip {
                display: inline-block;
                padding: 10px 18px;
                margin: 6px 6px;
                font-size: 0.95rem;
                font-weight: 700;
                border-radius: 0;
                background-color: #f5f5f5;
                color: #000;
                border: 1.5px solid #000;
                cursor: pointer;
                transition: all 0.2s ease;
            }

            .chip:hover {
                background-color: #000;
                color: #fff;
            }

            .chip.active {
                background-color: #000;
                color: #fff;
            }

            .category h2 {
                font-size: 1.5rem;
                font-weight: 800;
                margin: 50px 0 20px;
                padding-left: 0;
                border-left: none;
                color: #000;
                text-transform: uppercase;
            }

            .faq-item {
                border-top: 1.5px solid #000;
                padding: 20px 0;
                transition: rotate 0.3s ease;
            }

            .faq-question {
                font-size: 1.1rem;
                font-weight: 700;
                cursor: pointer;

                align-items: center;
                color: #111;
                transition: rotate 0.3s ease;
            }

            .faq-question::before {
                content: "‚ñ∂ ";
                font-weight: bold;
                font-size: 1.5rem;
            }

            .faq-question.active::before {
                content: "‚ñº ";
                transform: rotate(180deg);
            }

            .faq-answer {
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.3s ease;
                font-size: 0.95rem;
                color: #444;
                margin-top: 12px;
            }

            .faq-answer p {
                margin-top: 12px;
            }

            .copy-btn,
            .reply-copy {
                font-size: 0.85rem;
                padding: 6px 12px;
                background: #000;
                color: #fff;
                border: none;
                cursor: pointer;
                margin-top: 8px;
                transition: background 0.3s ease;
            }

            .copy-btn:hover,
            .reply-copy:hover {
                background: #444;
            }

            .scroll-top {
                position: fixed;
                bottom: 24px;
                right: 24px;
                background-color: #000;
                color: #fff;
                border: none;
                padding: 12px 16px;
                font-size: 1rem;
                font-weight: 700;
                opacity: 0.85;
                cursor: pointer;
                display: none;
                border-radius: 0;
                transition: all 0.3s ease;
            }

            .scroll-top.visible {
                display: block;
            }

            .replies-container h2 {
                font-size: 1.4rem;
                font-weight: 800;
                margin: 50px 0 20px;
                color: #000;
                text-transform: uppercase;
            }

            .reply-group h3 {
                font-size: 1.1rem;
                font-weight: 700;
                padding: 15px;
                background: #f7f7f7;
                cursor: pointer;
                position: relative;
                margin-bottom: 10px;
            }

            .reply-group h3::after {
                content: "+";
                position: absolute;
                right: 20px;
                font-size: 1.3rem;
            }

            .reply-group h3.active::after {
                content: "‚àí";
            }

            .reply-items {
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.3s ease;
                background: #fafafa;
                padding: 0 15px;
            }

            .reply-item {
                border-top: 1px solid #ccc;
                padding: 18px 0;
            }

            .reply-text {
                font-size: 1rem;
                color: #333;
            }

            .highlight {
                background-color: #ffff00;
            }

            .error {
                color: red;
                text-align: center;
                margin-top: 20px;
            }

            .hidden {
                display: none;
            }

            @media (max-width: 600px) {
                h1 {
                    font-size: 2rem;
                }

                .faq-question {
                    font-size: 1rem;
                }

                .faq-answer,
                .reply-text {
                    font-size: 0.9rem;
                }

                .chip {
                    font-size: 0.8rem;
                    padding: 8px 14px;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>C√¢u H·ªèi Th∆∞·ªùng G·∫∑p</h1>
            <div class="search-bar">
                <input
                    type="text"
                    id="searchInput"
                    placeholder="T√¨m ki·∫øm c√¢u h·ªèi..." />
            </div>
            <div class="chips" id="chips-container"></div>
            <div id="faq-container"></div>
            <div class="replies-container">
                <h2>C√¢u tr·∫£ l·ªùi m·∫´u</h2>
                <div class="replies-list" id="replies-list"></div>
            </div>
            <div id="error-message" class="error"></div>
            <button id="scroll-top" class="scroll-top">üîù</button>
        </div>

        <script>
            const spreadsheetId =
                "1ZkmUGU8EzIKNAJ_-_zXTrZ2CyqzsE3GaDDzimwMhIPg";
            const apiKey = "AIzaSyB_3MXA6ysK_6OGSTKtnfwCfNTB8Ovpod8";
            const range = "FAQs!A2:C";

            async function fetchSheetData() {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`;
                const errorMessage = document.getElementById("error-message");

                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(
                            `L·ªói ${response.status}: ${errorData.error.message}`
                        );
                    }
                    const data = await response.json();
                    if (!data.values || data.values.length === 0) {
                        errorMessage.textContent =
                            "Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu trong ph·∫°m vi FAQs!A2:C.";
                        return;
                    }
                    renderFAQ(data.values);
                    errorMessage.textContent = "";
                } catch (error) {
                    errorMessage.textContent = error.message;
                    console.error("Chi ti·∫øt l·ªói:", error);
                }
            }

            function renderFAQ(values) {
                const faqContainer = document.getElementById("faq-container");
                const chipsContainer =
                    document.getElementById("chips-container");
                let categories = {};

                values.forEach(([category, question, answer]) => {
                    if (!categories[category]) categories[category] = [];
                    categories[category].push({ question, answer });
                });

                const allChip = document.createElement("div");
                allChip.className = "chip all active";
                allChip.textContent = `T·∫•t c·∫£ (${values.length})`;
                allChip.dataset.category = "all";
                chipsContainer.appendChild(allChip);

                for (const category of Object.keys(categories)) {
                    const chip = document.createElement("div");
                    chip.className = `chip ${category
                        .toLowerCase()
                        .replace(/\s+/g, "")}`;

                    chip.setAttribute(
                        "href",
                        `#${category.toLowerCase().replace(/\s+/g, "")}`
                    );
                    chip.textContent = `${category} (${categories[category].length})`;
                    chip.dataset.category = category
                        .toLowerCase()
                        .replace(/\s+/g, "");
                    chip.dataset.total = categories[category].length; // L∆∞u t·ªïng s·ªë
                    chipsContainer.appendChild(chip);
                }

                for (const [category, items] of Object.entries(categories)) {
                    const categoryDiv = document.createElement("div");
                    categoryDiv.className = `category ${category
                        .toLowerCase()
                        .replace(/\s+/g, "")} active`;
                    categoryDiv.innerHTML = `<h2 id="${category
                        .toLowerCase()
                        .replace(/\s+/g, "")}">${category} (${
                        items.length
                    })</h2>`;

                    items.forEach((item) => {
                        const faqItem = document.createElement("div");
                        faqItem.className = "faq-item";
                        faqItem.innerHTML = `
                        <div class="faq-question">${item.question}</div>
                        <div class="faq-answer">
                            <p>${item.answer}</p>
                            <button class="copy-btn">Copy</button>
                        </div>
                    `;
                        categoryDiv.appendChild(faqItem);
                    });

                    faqContainer.appendChild(categoryDiv);
                }

                document.querySelectorAll(".faq-question").forEach((item) => {
                    item.addEventListener("click", () => {
                        const answer = item.nextElementSibling;
                        const isActive = item.classList.contains("active");
                        document
                            .querySelectorAll(".faq-question")
                            .forEach((q) => {
                                q.classList.remove("active");
                                q.nextElementSibling.style.maxHeight = null;
                            });
                        if (!isActive) {
                            item.classList.add("active");
                            answer.style.maxHeight = answer.scrollHeight + "px";
                        }
                    });
                });

                document.querySelectorAll(".copy-btn").forEach((btn) => {
                    btn.addEventListener("click", () => {
                        const answerText =
                            btn.previousElementSibling.textContent;
                        navigator.clipboard.writeText(answerText).then(() => {
                            btn.textContent = "ƒê√£ copy!";
                            setTimeout(() => (btn.textContent = "Copy"), 2000);
                        });
                    });
                });

                const searchInput = document.getElementById("searchInput");
                searchInput.addEventListener("input", () => {
                    const query = searchInput.value.toLowerCase();
                    let totalMatches = 0;

                    document.querySelectorAll(".faq-item").forEach((item) => {
                        const questionEl = item.querySelector(".faq-question");
                        const answerEl = item.querySelector(".faq-answer p");
                        const question = questionEl.textContent.toLowerCase();
                        const answer = answerEl.textContent.toLowerCase();
                        const isMatch =
                            question.includes(query) || answer.includes(query);

                        item.classList.toggle("hidden", !isMatch);
                        if (isMatch) totalMatches++;

                        if (query) {
                            questionEl.innerHTML =
                                questionEl.textContent.replace(
                                    new RegExp(query, "gi"),
                                    (match) =>
                                        `<span class="highlight">${match}</span>`
                                );
                            answerEl.innerHTML = answerEl.textContent.replace(
                                new RegExp(query, "gi"),
                                (match) =>
                                    `<span class="highlight">${match}</span>`
                            );
                        } else {
                            questionEl.innerHTML = questionEl.textContent;
                            answerEl.innerHTML = answerEl.textContent;
                        }
                    });

                    document
                        .querySelectorAll(".category")
                        .forEach((category) => {
                            const items = category.querySelectorAll(
                                ".faq-item:not(.hidden)"
                            );
                            const categoryName = category
                                .querySelector("h2")
                                .textContent.split(" (")[0];
                            category.classList.toggle(
                                "hidden",
                                items.length === 0
                            );
                            category.querySelector(
                                "h2"
                            ).textContent = `${categoryName} (${items.length})`;
                        });

                    document
                        .querySelectorAll(".chip:not(.all)")
                        .forEach((chip) => {
                            const categoryClass = chip.dataset.category;
                            const matchingItems = document.querySelectorAll(
                                `.category.${categoryClass} .faq-item:not(.hidden)`
                            ).length;
                            const categoryName =
                                chip.textContent.split(" (")[0];
                            chip.textContent = `${categoryName} (${matchingItems})`;
                        });

                    const allChip = document.querySelector(".chip.all");
                    allChip.textContent = `T·∫•t c·∫£ (${totalMatches})`;
                });

                document.querySelectorAll(".chip").forEach((chip) => {
                    chip.addEventListener("click", () => {
                        document
                            .querySelectorAll(".chip")
                            .forEach((c) => c.classList.remove("active"));
                        chip.classList.add("active");
                        const selectedCategory = chip.dataset.category;
                        document
                            .querySelectorAll(".category")
                            .forEach((category) => {
                                category.classList.toggle(
                                    "active",
                                    selectedCategory === "all" ||
                                        category.classList.contains(
                                            selectedCategory
                                        )
                                );
                            });
                    });
                });

                const scrollTopBtn = document.getElementById("scroll-top");
                window.addEventListener("scroll", () => {
                    scrollTopBtn.classList.toggle(
                        "visible",
                        window.scrollY > 200
                    );
                });
                scrollTopBtn.addEventListener("click", () => {
                    window.scrollTo({ top: 0, behavior: "smooth" });
                });
            }
            async function fetchRepliesData() {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/Replies!A1:A?key=${apiKey}`;
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`L·ªói ${response.status}`);
                    const data = await response.json();
                    if (data.values && data.values.length)
                        renderReplies(data.values);
                } catch (error) {
                    console.error("L·ªói fetch Replies:", error);
                }
            }

            function renderReplies(values) {
                const repliesList = document.getElementById("replies-list");
                repliesList.innerHTML = "";
                let currentGroup = null;
                let replies = [];

                values.forEach((row) => {
                    const text = row[0];
                    if (!text) return;

                    if (text.trim().startsWith("!")) {
                        if (currentGroup && replies.length) {
                            addRepliesGroup(
                                repliesList,
                                currentGroup.slice(1),
                                replies
                            );
                        }
                        currentGroup = text;
                        replies = [];
                    } else if (currentGroup) {
                        replies.push(text);
                    }
                });

                if (currentGroup && replies.length) {
                    addRepliesGroup(
                        repliesList,
                        currentGroup.slice(1),
                        replies
                    );
                }

                document
                    .querySelectorAll(".reply-group h3")
                    .forEach((header) => {
                        header.addEventListener("click", () => {
                            const items = header.nextElementSibling;
                            const isActive =
                                header.classList.contains("active");

                            document
                                .querySelectorAll(".reply-group h3")
                                .forEach((h) => {
                                    h.classList.remove("active");
                                    h.nextElementSibling.style.maxHeight = null;
                                });

                            if (!isActive) {
                                header.classList.add("active");
                                items.style.maxHeight =
                                    items.scrollHeight + "px";
                            }
                        });
                    });
            }

            function addRepliesGroup(container, title, replies) {
                const group = document.createElement("div");
                group.className = "reply-group active";
                group.innerHTML = `<h3>${title}</h3><div class="reply-items"></div>`;

                const itemsContainer = group.querySelector(".reply-items");
                replies.forEach((reply) => {
                    const item = document.createElement("div");
                    item.className = "reply-item";
                    item.innerHTML = `
                    <span class="reply-text">${reply}</span>
                    <button class="reply-copy">Copy</button>
                `;
                    itemsContainer.appendChild(item);
                });

                container.appendChild(group);

                group.querySelectorAll(".reply-copy").forEach((btn) => {
                    btn.addEventListener("click", () => {
                        const text = btn.previousElementSibling.textContent;
                        navigator.clipboard.writeText(text).then(() => {
                            btn.textContent = "ƒê√£ copy!";
                            setTimeout(() => (btn.textContent = "Copy"), 2000);
                        });
                    });
                });
            }
            document.addEventListener("DOMContentLoaded", () => {
                fetchSheetData();
                fetchRepliesData();
            });
        </script>
    </body>
</html>
